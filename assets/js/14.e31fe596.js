(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{202:function(e,a,t){"use strict";t.r(a);var s=t(3),o=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"run"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#run"}},[e._v("#")]),e._v(" Run")]),e._v(" "),t("h2",{attrs:{id:"requirements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[e._v("#")]),e._v(" Requirements")]),e._v(" "),t("p",[e._v("Note: Ensure "),t("code",[e._v("clickhouse-server")]),e._v(" and "),t("code",[e._v("kafka")]),e._v(" work before running clickhouse_sinker.")]),e._v(" "),t("h2",{attrs:{id:"configs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configs"}},[e._v("#")]),e._v(" Configs")]),e._v(" "),t("blockquote",[t("p",[e._v("There are two ways to get config: a local single config, or Nacos.")])]),e._v(" "),t("ul",[t("li",[t("p",[e._v("For local file:")]),e._v(" "),t("p",[t("code",[e._v("clickhouse_sinker --local-cfg-file docker/test_auto_schema.json")])])]),e._v(" "),t("li",[t("p",[e._v("For Nacos:")]),e._v(" "),t("p",[t("code",[e._v("clickhouse_sinker --nacos-addr 127.0.0.1:8848 --nacos-username nacos --nacos-password nacos --nacos-dataid test_auto_schema")])])])]),e._v(" "),t("blockquote",[t("p",[e._v("Read more detail descriptions of config in "),t("RouterLink",{attrs:{to:"/guide/docs/config.html"}},[e._v("here")])],1)]),e._v(" "),t("h2",{attrs:{id:"example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[e._v("#")]),e._v(" Example")]),e._v(" "),t("p",[e._v("Let's follow up a piece of the systest script.")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("Prepare")]),e._v(" "),t("ul",[t("li",[e._v("let's checkout "),t("code",[e._v("clickhouse_sinker")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ git clone https://github.com/housepower/clickhouse_sinker.git\n$ cd clickhouse_sinker\n")])])]),t("ul",[t("li",[e._v("let's start standalone clickhouse-server and kafka in container:")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ docker-compose up -d\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Create a simple table in Clickhouse")]),e._v(" "),t("blockquote",[t("p",[e._v("It's not the duty for clickhouse_sinker to auto create table, so we should do that manually.")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CREATE TABLE IF NOT EXISTS test_auto_schema\n(\n    `day` Date DEFAULT toDate(time),\n    `time` DateTime,\n    `name` String,\n    `value` Float64\n)\nENGINE = MergeTree\nPARTITION BY day\nORDER BY (time, name);\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Enable topic is created in kafka")]),e._v(" "),t("blockquote",[t("p",[e._v("I use "),t("a",{attrs:{href:"https://github.com/birdayz/kaf",target:"_blank",rel:"noopener noreferrer"}},[e._v("kaf"),t("OutboundLink")],1),e._v(" tool to create topics.")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kaf topic create topic1 -p 1 -r 1\nâœ… Created topic!\n      Topic Name:            topic1\n      Partitions:            1\n      Replication Factor:    1\n      Cleanup Policy:        delete\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Run clickhouse_sinker")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("clickhouse_sinker --local-cfg-file docker/test_auto_schema.json\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Send messages to the topic")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('echo \'{"time" : "2020-12-18T03:38:39.000Z", "name" : "name1", "value" : 1}\' | kaf -b \'127.0.0.1:9092\' produce topic1\necho \'{"time" : "2020-12-18T03:38:39.000Z", "name" : "name2", "value" : 2}\' | kaf -b \'127.0.0.1:9092\' produce topic1\necho \'{"time" : "2020-12-18T03:38:39.000Z", "name" : "name3", "value" : 3}\' | kaf -b \'127.0.0.1:9092\' produce topic1\n')])])]),t("ul",[t("li",[e._v("Check the data in clickhouse")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("SELECT count() FROM test_auto_schema;\n\n3 rows in set. Elapsed: 0.016 sec.\n\n")])])])])])])}),[],!1,null,null,null);a.default=o.exports}}]);